<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Aventura conversacional con inteligencia real</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">
		<!-- My CSS -->
		<link href="fontawesome/css/all.css" rel="stylesheet">
		<link rel="stylesheet" href="css/custom.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="my-header">
			</div>

			<div class="my-foot">
				<a class="github-button" href="https://github.com/jgsogo/GodotMadridCpp/subscription" data-icon="octicon-eye" aria-label="Watch jgsogo/GodotMadridCpp on GitHub">
					jgsogo/GodotMadridCpp
				</a>
				<a class="twitter-share-button" rel="me" href="https://twitter.com/intent/tweet">
					<link rel="me" href="https://twitter.com/jgsogo">
					Tweet @jgsogo
				</a>
				<img class="img-inline" src="img/by-nc-sa.png">
				Javier G. Sogo | Senior software developer |
				<img class="img-inline" src="img/jfrog-logo.png"> JFrog LTD |
				<img class="img-inline" src="img/conan-logo.png"> Conan C/C++ Package Manager
			</div>


			<div class="slides">
				<section data-transition="convex" class="no-footer">
					<h1 class="lol">GDNative</h1>
					<h1><small>Using C++ inside Godot</small></h1>
					
					<div class="speaker-conference">
						<div>
							<img style="height: 100px;" data-src="img/godot-logo.png">
							<i class="fab fa-gratipay"></i>
							<img style="height: 100px;" data-src="img/cpp-logo.png">
						</div>

						<div class="conference">
							<hr/>
							<p>21 de noviembre de 2019</p>	
							<p>Madrid C/C++ User Group</p>
							
						</div>
						<div class="middle"></div>
						<div class="speaker">
							<hr/>
							<p>Javier García Sogo</p>
							<p>
									C++/Python/DevOps... engineer
							</p>
							<p>
								<i class="fab fa-twitter"></i>
								<i class="fab fa-github"></i>
								&nbsp; @jgsogo
							</p>
						</div>
					</div>
				</section>

				<!-- ABOUT ME -->
				<section class="no-footer text-animation" data-slide-type="author" data-background-color="#414141">
					<h3>About me</h3>
					<img data-src="images/me.png" class="avatar"/>
					<p>Javier G. Sogo</p>
					<p>
						Software | 
						<span class="blue"><b>Conan.io</b></span> |
						<span class="green"><b>JFrog</b>&trade;</span>
					</p>
					<p>
						<small>
							<img data-src="img/github-logo.svg" class="brand-icon"/>jgsogo
								&nbsp;&nbsp;&nbsp;&nbsp; 
							<img data-src="img/twitter-logo.svg" class="brand-icon"/>@jgsogo
						</small>
					</p>
					<div class="text-animation-wrapper work-with" prefix="Attending ">
						<div style="display: none">
							<span>Madrid C/C++</span>
							<span>NLP</span>
							<span>Lingẅars</span>
							<span>Data</span>
						</div>
						<p class="text-animation"></p>
					</div>
				</section>

                <section data-transition="convex">
                    <section class="no-footer">
                        <h1>Godot 001</h1>
                    </section>

                    <section>
                        <h2>Godot uses GDScript</h2>
                        <ul>
                            <li>Powerful: signals, yields, singletons,...</li>
                            <li>Fast enough</li>
                            <li>Dynamic typing</li>
                            <li>Sooooo easy</li>
                        </ul>
                    </section>

                    <section>
                        <h2>GDScript example</h2>
                        <pre><code class="hljs" data-trim data-noescape>
                            # Hero.gd
                            extends LivingThing

                            var life_points = 100
                            const axis_x = Vector2(1, 0)

                            func receive_impact(direction, damage):
                                life_points = life_points - damage
                                if life_points <= 0:
                                emit_signal("killed", self)
                        </code></pre>
                        <p>Each file is a class</p>
                    </section>

                    <section>
                        <h2>Godot framework</h2>
                        <ul>
                            <li>Graphics 2D/3D</li>
                            <li>Audio</li>
                            <li>Physics</li>
                            <li>I/O</li>
                            <li>Networking</li>
                            <li>...</li>
                        </ul>
                    </section>
                </section>

                <section data-transition="convex">
                    <section class="no-footer">
                        <h1>Interactive fiction</h1>
                    </section>

                    <section>
                        <h2>Interactive fiction</h2>
                        <img data-src="images/mario3-dog.gif">
                    </section>

                    <section>
                        <h2>Interactive fiction</h2>
                        <img data-src="images/samandmax.jpg">
                    </section>

                    <section>
                        <h2>Interactive fiction</h2>
                        <img data-src="images/zork.jpg">
                    </section>

                    <section>
                        <h2>Can we make it better?</h2>
                        <p class="fragment">Use state-of-the-art NLP libraries</p>
                        <p class="fragment">Tensorflow, Freeling,... many are C++</p>
                        <p class="fragment">Plug them in using GDNative</p>
                    </section>
                </section>

				<section data-background="images/zeppelin.jpg">
					<!-- Desastre de Led Zeppelin en el Live Aid -->
					<h2 class="box-shadow-black">Live demo!</h2>
				</section>

                <section data-transition="convex">
                    <section class="no-footer">
                        <h1>GDNative</h1>
                        <h4>"C" interface</h4>
                        <h4>Boilerplate</h4>
                    </section>

                    <section>
                        <h2>"C" interface</h2>
                        <pre><code class="hljs cpp" data-trim data-noescape>
                            #include &lt;core/Godot.hpp>
                            #include "godot_ia.h"

                            /** GDNative Initialize **/
                            extern "C" void GDN_EXPORT godot_gdnative_init(godot_gdnative_init_options *o) {
                                godot::Godot::gdnative_init(o);
                            }

                            /** GDNative Terminate **/
                            extern "C" void GDN_EXPORT godot_gdnative_terminate(godot_gdnative_terminate_options *o) {
                                godot::Godot::gdnative_terminate(o);
                            }

                            /** NativeScript Initialize **/
                            extern "C" void GDN_EXPORT godot_nativescript_init(void *handle) {
                                godot::Godot::nativescript_init(handle);
                                godot::register_class&lt;godot::GodotGameIA>();
                            }
                        </code></pre>
                        <p><small>Linked with &nbsp; <code>GodotNativeTools/godot-cpp</code></small></p>
                    </section>
                    
                    <section>
                        <h2>"C" interface</h2>
                        <pre><code class="hljs cpp" data-trim data-noescape data-line-numbers="2, 17">
                            #include &lt;core/Godot.hpp>
                            #include "godot_ia.h"

                            /** GDNative Initialize **/
                            extern "C" void GDN_EXPORT godot_gdnative_init(godot_gdnative_init_options *o) {
                                godot::Godot::gdnative_init(o);
                            }

                            /** GDNative Terminate **/
                            extern "C" void GDN_EXPORT godot_gdnative_terminate(godot_gdnative_terminate_options *o) {
                                godot::Godot::gdnative_terminate(o);
                            }

                            /** NativeScript Initialize **/
                            extern "C" void GDN_EXPORT godot_nativescript_init(void *handle) {
                                godot::Godot::nativescript_init(handle);
                                godot::register_class&lt;godot::GodotGameIA>();
                            }
                        </code></pre>
                        <p><small>Linked with &nbsp; <code>GodotNativeTools/godot-cpp</code></small></p>
                    </section>

                    <section>
                        <h2><code>.gdnlib</code></h2>
                        <pre><code class="hljs ini" data-trim data-noescape data-line-numbers="10">
                            [general]
                            singleton=false
                            load_once=true
                            symbol_prefix="godot_"
                            reloadable=false
                            
                            [entry]
                            X11.64="res://package/bin/libgodot-game-ia.so"
                            Windows.64="res://package/bin/libgodot-game-ia.dll"
                            OSX.64="res://package/bin/libgodot-game-ia.dylib"
                            
                            [dependencies]
                            X11.64=[]
                            Windows.64=[]
                            OSX.64=[]
                        </code></pre>
                    </section>

                    <section>
                        <h2><code>.gdns</code></h2>
                        <pre><code class="hljs ini" data-trim data-noescape data-line-numbers="8">
                            [gd_resource type="NativeScript" load_steps=2 format=2]

                            [ext_resource path="res://package/bin/godot-game-ia.gdnlib" type="GDNativeLibrary" id=1]

                            [resource]

                            resource_name = "godot-game-ia"
                            class_name = "GodotGameIA"
                            library = ExtResource( 1 )
                            _sections_unfolded = [ "Resource" ]
                        </code></pre>
                    </section>
                </section>

                <section data-transition="convex">
                    <section class="no-footer">
                        <h1>GDNative</h1>
                        <h4>C++ implementation</h4>
                    </section>

                    <section>
                        <h2><code>C++</code> implementation</h2>
                        <pre><code class="hljs cpp" data-trim data-noescape data-line-numbers="1-12, 20-21">
                        #include &lt;core/Godot.hpp>
                        #include &lt;Reference.hpp>

                        namespace godot {
                            class GodotGameIA : public Reference {
                                GODOT_CLASS(GodotGameIA, Reference);
                            public:
                                GodotGameIA();
                                ~GodotGameIA();

                                void _init(); // _init must exist as it is called by Godot
                                static void _register_methods();

                                void send_message(String message, Variant chat_id);
                                void register_callback(godot::Object *p_instance, Variant chat_id);
                                void remove_callback(Variant chat_id);
                            protected:
                                struct Impl;
                                std::unique_ptr<Impl> pImpl;
                            };
                        }
                        </code></pre>
                    </section>

                    <section>
                        <h2><code>C++</code> implementation</h2>
                        <pre><code class="hljs cpp" data-trim data-noescape data-line-numbers="1-12, 20-21">
                        namespace godot {
                            class GodotGameIA : public Reference {
                                GODOT_CLASS(GodotGameIA, Reference);
                                ...
                                void send_message(String message, Variant chat_id);
                                void register_callback(godot::Object *p_instance, Variant chat_id);
                                void remove_callback(Variant chat_id);
                                ...
                            };
                        }
                        </code></pre>

                        <pre><code class="hljs cpp" data-trim data-noescape data-line-numbers="1-12, 20-21">
                        void GodotGameIA::_register_methods() {
                            register_method("send_message", &GodotGameIA::send_message);
                            register_method("register_callback", &GodotGameIA::register_callback);
                            register_method("remove_callback", &GodotGameIA::remove_callback);

                            register_signal<GodotGameIA>("signal_ready", "id", GODOT_VARIANT_TYPE_INT, "message", GODOT_VARIANT_TYPE_STRING);
                            register_signal<GodotGameIA>("signal_disconnected", "id", GODOT_VARIANT_TYPE_INT, "message", GODOT_VARIANT_TYPE_STRING);
                        }</code></pre>
                    </section>
                </section>

                <section data-transition="convex">
                    <section class="no-footer">
                        <h1>Godot <i class="fas fa-long-arrow-alt-right"></i> C++ <i class="fas fa-long-arrow-alt-right"></i> NLP</h1>
                    </section>

                    <section>
                        <h2>Godot <i class="fas fa-long-arrow-alt-right"></i> C++ <i class="fas fa-long-arrow-alt-right"></i> NLP</h2>
                        <pre><code class="hljs gd" data-trim data-noescape>
                            onready var GodotGameIA = preload("res://package/bin/godot-game-ia.gdns").new()

                            func _ready():
                                GodotGameIA.connect("signal_ready", self, "_on_GodotGameIA_signal_ready")
                                GodotGameIA.connect("signal_disconnected", self, "_on_GodotGameIA_signal_disconnected")
    
                            func _on_Dialog_text_sent(msg)->void:
                                GodotGameIA.send_message(msg, chat_id)
                        </code></pre>
                        <p><small>Forward the message to the C++ library</small></p>
    
                        <pre><code class="hljs cpp" data-trim data-noescape>
                            void GodotGameIA::send_message(String message, Variant chat_id) {
                                pImpl->dialog.send_message(chat_id, message.utf8().get_data());
                            }
                        </code></pre>
                        <p><small>Forward the message to the NLP library</small></p>
                    </section>
                </section>

                <section data-transition="convex">
                    <section class="no-footer">
                        <h1>Godot <i class="fas fa-long-arrow-alt-left"></i> C++ <i class="fas fa-long-arrow-alt-left"></i> NLP</h1>
                    </section>

                    <section>
                        <h2>Godot <i class="fas fa-long-arrow-alt-left"></i> C++ <i class="fas fa-long-arrow-alt-left"></i> NLP</h2>
                        <pre><code class="hljs python" data-trim data-noescape>
                            onready var GodotGameIA = preload("res://package/bin/godot-game-ia.gdns").new()

                            func _on_Dialog_popup_show():
                                # Pass myself to the C++ library
                                GodotGameIA.register_callback(self, chat_id)
                        </code></pre>
                        <hr/>
                        <pre><code class="hljs cpp" data-trim data-noescape>
                            void GodotGameIA::register_callback(godot::Object *p_instance, Variant chat_id) {
                                // Use a lambda for the callback
                                pImpl->dialog.connect(chat_id, [=](const std::string& message) {
                                    p_instance->call("gdscript_callback", message.c_str());
                                });
                            }
                        </code></pre>
                        <hr/>
                        <pre><code class="hljs gd" data-trim data-noescape>
                            # Receive messages from C++
                            func gdscript_callback(msg):
                                $Dialog.add_text("Johnny: " + msg)
                        </code></pre>
                    </section>
                </section>

                <section data-transition="convex">
                    <section class="no-footer">
                        <h1>NLP library</h1>
                    </section>

                    <section data-background="images/callcenter.jpg">
                    </section>
                </section>

				<section data-transition="convex" class="no-footer">
					<h1 class="lol">GDNative</h1>
					<h1><small>Using C++ inside Godot</small></h1>
					
					<div class="speaker-conference">
						<div>
							<img style="height: 100px;" data-src="img/godot-logo.png">
							<i class="fab fa-gratipay"></i>
							<img style="height: 100px;" data-src="img/cpp-logo.png">
						</div>

						<div class="conference">
							<hr/>
							<p>21 de noviembre de 2019</p>	
							<p>Madrid C/C++ User Group</p>
							
						</div>
						<div class="middle"></div>
						<div class="speaker">
							<hr/>
							<p>Javier García Sogo</p>
							<p>
									C++/Python/DevOps... engineer
							</p>
							<p>
								<i class="fab fa-twitter"></i>
								<i class="fab fa-github"></i>
								&nbsp; @jgsogo
							</p>
						</div>
					</div>
				</section>

            </div>
        </div>

		<script src="js/reveal.js"></script>
		<script src="js/jquery-3.4.1.min.js"></script>
		<script src="js/custom.js"></script>
		<script src="js/text-animation.js"></script>

		<!-- Social buttons -->
		<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
		<script async defer src="https://buttons.github.io/buttons.js"></script>

		<script>

			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				history: true,
				slideNumber: true,
				previewLinks: true,
				pdfSeparateFragments: false,
				pdfMaxPagesPerSlide: 1,
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true },
				]
			});
			Reveal.addEventListener( 'ready', function( event ) {
				setTimeout(function () {
					footer_visibility(event.currentSlide, Reveal.isSpeakerNotes());
				}, 100);
			});

			var animated_elements = []
			var animated_histograms = []
			Reveal.addEventListener( 'slidechanged', function( event ) {
				setTimeout(function () {
					footer_visibility(event.currentSlide, Reveal.isSpeakerNotes());
				}, 100);

				// Start text-animation
				animated_elements.forEach(function(elem) {elem.stop = true;});
				animated_elements.length = 0;
				$(event.currentSlide).find(".text-animation-wrapper").each(function(){
					var data = animate_element($(this));
					animated_elements.push(data);
				});
				
			});
		</script>
	</body>
</html>
